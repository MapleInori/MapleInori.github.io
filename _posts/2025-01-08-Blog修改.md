---
layout: article
title: 给Blog本身改了点东西
tag: Blog
---
## 碎碎念

记录一下改动了什么，以防以后出问题。

怎么能加多个tag呢？还没看到，哎，我好菜。

突然发现这一个为什么在最下边是第一篇？B是最小的？

## 添加bilibili链接

通过对文件夹内容搜索，在weibo所在的位置后边复制了一份并改为了bilibili，个人主页链接一开始没注意写的bilibili.com，实际应该写space.bilibili.com，在config里添加我的id之后发现打开是三体动画，愣是没反应过来，我还以为都现在了打开B站还有三体的开屏广告？硬控我半分钟

其实是因为[这个链接](https://bilibili.com/35246697)正好是三体动画，跟我的ID一样。hhhhhh

## 图片加载修复

本地编辑时，直接粘贴的图片的链接无法在网站上正常加载，所以搞了拼接，让它直接去加载仓库里的图片。

本地形如这样

```markdown
![1737529592551](image/2025-01-22-数据结构大纲/1737529592551.png)
```

实际src会为这样，这样是无法加载的

```markdown
https://MapleInori.net/2025/01/08/image/2025-01-08-first_test/1737546135783.png
```

于是给article.html添加如下代码，万一以后有其他image之类的内容，还是要区分一下image/20开头，总不能超过100年。hhhhh

```html
<script>
  // 确保页面加载完成后执行
  document.addEventListener("DOMContentLoaded", function() {
    const images = document.querySelectorAll('img');
    images.forEach(img => {
      const src = img.getAttribute('src');
      if (src && src.startsWith('image/20')) {
        // 动态拼接GitHub URL，使其在不影响本地图片正常加载的情况下网页也能正常加载图片
        img.setAttribute('src', 'https://github.com/MapleInori/MapleInori.github.io/blob/main/_posts/' + src + '?raw=true');
      }
    });
  });
</script>
```

## 加速图片加载

修改

```c
img.setAttribute('src', 'https://github.com/MapleInori/MapleInori.github.io/blob/main/_posts/' + src + '?raw=true');
```

为

```C
img.setAttribute('src', 'https://cdn.jsdelivr.net/gh/MapleInori/MapleInori.github.io/_posts/' + src + '?raw=true');
```

## 添加LeanCloud

修改leancloud.js，添加if判断

```js
function searchKey(key) {
      if (!key) {
        console.error('Invalid key provided:', key);
        return Promise.reject('Invalid key');
      }
      var query = new AV.Query(appClass);
      query.equalTo('key', key);
      return query.first();
    }
```

修改下方代码

```js
    function get(key, callback) {
      searchKey(key).then(function(result) {
        if (result) {
          callback && callback(result.attributes.views);
        }
      }, errorHandler);
    }
```

为

```js
    function get(key, callback) {
      searchKey(key).then(function(result) {
        console.log(result);  // 打印查询结果
        if (result) {
          callback && callback(result.attributes.views);
        } else {
          insert(key, title).then(function(result) {
            increment(result).then(function(result) {
              callback && callback(result.attributes.views);
            });
          }, errorHandler);
        }
      }, errorHandler);
```


[使用 LeanCloud 为 Github Pages 添加阅读量统计 (snownight22.github.io)](https://snownight22.github.io/cassidyblog/2023/06/18/LeanCloudForVisitorCount)

## 添加GoogleAnalysis

前端控制台出现如下报错，关闭广告拦截插件即可。

```shell
Failed to load resource: net::ERR_BLOCKED_BY_CLIENT
```

然后出现如下报错

```shell
GET https://www.googletagmanager.com/gtag/js?id=G-2S7EGHFE6M net::ERR_SSL_PROTOCOL_ERROR
```

[使用Google Analytics监听GitHub pages页面访问量 | Marvin&#39;s blog (winxuan.github.io)](https://winxuan.github.io/posts/add-google-analytics/)
